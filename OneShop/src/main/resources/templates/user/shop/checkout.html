<!--<!DOCTYPE html>-->
<!--<html lang="vi"-->
<!--      xmlns:th="http://www.thymeleaf.org"-->
<!--      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"-->
<!--      layout:decorate="~{layouts/user}">-->
<!--<head>-->
<!--    <title>Thanh toán</title>-->

<!--    <style>-->
<!--        /* Canh phải và cố định cách hiển thị ô tiền của toàn bộ cột 2 */-->
<!--        .summery-table th:nth-child(2),-->
<!--        .summery-table td:nth-child(2) {-->
<!--          text-align: right;-->
<!--          white-space: nowrap;-->
<!--          font-variant-numeric: tabular-nums;-->
<!--        }-->

<!--        /* Theme gán flex/left riêng cho hàng phí vận chuyển -> reset về ô bảng thường */-->
<!--        .summery-table .order-shipping td:nth-child(2) {-->
<!--          display: table-cell !important;-->
<!--          text-align: right !important;-->
<!--          padding-left: 0 !important;-->
<!--        }-->

<!--        /* Một số theme đẩy ký hiệu đ/₫ lên trên (superscript) -> đưa về baseline */-->
<!--        .summery-table td:nth-child(2) sup,-->
<!--        .summery-table td:nth-child(2) .currency,-->
<!--        .summery-table td:nth-child(2) .woocommerce-Price-currencySymbol {-->
<!--          position: static !important;-->
<!--          top: 0 !important;-->
<!--          vertical-align: baseline !important;-->
<!--          font-size: 1em !important;-->
<!--          line-height: 1 !important;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->

<!--<body>-->
<!--<main layout:fragment="content">-->
<!--    <div class="axil-checkout-area axil-section-gap">-->
<!--        <div class="container">-->

<!--            <form th:action="@{/place-order}" method="post">-->
<!--                <div class="row">-->
<!--                    &lt;!&ndash; CỘT TRÁI: ĐỊA CHỈ + GHI CHÚ &ndash;&gt;-->
<!--                    <div class="col-lg-6">-->
<!--                        <div class="axil-checkout-billing">-->
<!--                            <h4 class="title mb&#45;&#45;40">Chi tiết giao hàng</h4>-->

<!--                            <div class="mb-4">-->
<!--                                <a th:href="@{/cart}" class="axil-btn btn-outline btn-sm">-->
<!--                                    <i class="fal fa-long-arrow-left"></i> Quay lại giỏ hàng-->
<!--                                </a>-->
<!--                            </div>-->

<!--                            <div th:if="${error}" th:text="${error}" class="alert alert-danger"></div>-->

<!--                            <div th:if="${addresses.isEmpty()}" class="mb-4">-->
<!--                                <p>Bạn chưa có địa chỉ nào được lưu.</p>-->
<!--                                <a th:href="@{/my-account(tab=${'addresses'})}" class="axil-btn btn-outline">Thêm địa chỉ mới</a>-->
<!--                            </div>-->

<!--                            <div th:each="address, iter : ${addresses}" class="custom-address-option">-->
<!--                                <div class="address-main-content">-->
<!--                                    <input type="radio"-->
<!--                                           name="shipping_address"-->
<!--                                           th:id="'address' + ${iter.index}"-->
<!--                                           th:value="${address.maDiaChi}"-->
<!--                                           th:checked="${iter.index == 0}"-->
<!--                                           class="address-radio">-->
<!--                                    <label th:for="'address' + ${iter.index}" class="address-content">-->
<!--                                        <div class="address-header">-->
<!--                                            <strong th:text="${address.tenNguoiNhan} + ' | ' + ${address.soDienThoai}"></strong>-->
<!--                                        </div>-->
<!--                                        <span class="address-details"-->
<!--                                              th:text="${address.soNhaDuong} + ', ' + ${address.phuongXa} + ', ' + ${address.quanHuyen} + ', ' + ${address.tinhThanh}"></span>-->
<!--                                    </label>-->
<!--                                </div>-->

<!--                                <a th:href="@{/checkout/edit-address/{id}(id=${address.maDiaChi})}"-->
<!--                                   class="btn-sm address-edit-btn">Sửa</a>-->
<!--                            </div>-->

<!--                            <div class="form-group">-->
<!--                                <label>Ghi chú đơn hàng (tùy chọn)</label>-->
<!--                                <textarea name="notes" rows="2" placeholder="Ghi chú về đơn hàng của bạn..."></textarea>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->

<!--                    &lt;!&ndash; CỘT PHẢI: TỔNG TIỀN + PHƯƠNG THỨC THANH TOÁN &ndash;&gt;-->
<!--                    <div class="col-lg-6">-->
<!--                        <div class="axil-order-summery order-checkout-summery">-->
<!--                            <h5 class="title mb&#45;&#45;20">Đơn hàng của bạn</h5>-->
<!--                            <div class="summery-table-wrap">-->
<!--                                <table class="table summery-table">-->
<!--                                    &lt;!&ndash; FIX: Khóa bề rộng cột tiền để số không “nhảy” &ndash;&gt;-->
<!--                                    <colgroup>-->
<!--                                        <col>-->
<!--                                        <col style="width: 170px;">-->
<!--                                    </colgroup>-->

<!--                                    <thead>-->
<!--                                    <tr>-->
<!--                                        <th>Sản phẩm</th>-->
<!--                                        <th>Tạm tính</th>-->
<!--                                    </tr>-->
<!--                                    </thead>-->
<!--                                    <tbody>-->
<!--                                    <tr th:each="item : ${cartItems}" class="order-product">-->
<!--                                        <td th:text="${item.sanPham.tenSanPham} + ' x ' + ${item.soLuong}"></td>-->
<!--                                        <td th:text="${#numbers.formatDecimal(item.thanhTien, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>-->
<!--                                    </tr>-->
<!--                                    <tr class="order-subtotal">-->
<!--                                        <td>Tạm tính</td>-->
<!--                                        <td th:text="${#numbers.formatDecimal(subtotal, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>-->
<!--                                    </tr>-->
<!--                                    <tr class="order-shipping">-->
<!--                                        <td>Phí vận chuyển</td>-->
<!--                                        <td th:text="${#numbers.formatDecimal(shippingFee, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>-->
<!--                                    </tr>-->
<!--                                    <tr class="order-shipping text-success"-->
<!--                                        th:if="${membershipDiscount != null and membershipDiscount.compareTo(T(java.math.BigDecimal).ZERO) > 0}">-->
<!--                                        <td>Giảm giá hạng <strong th:text="${membershipTier != null ? membershipTier.tenHang : ''}"></strong></td>-->
<!--                                        <td th:text="'-' + ${#numbers.formatDecimal(membershipDiscount, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>-->
<!--                                    </tr>-->
<!--                                    <tr class="order-shipping text-success"-->
<!--                                        th:if="${couponDiscount != null and couponDiscount.compareTo(T(java.math.BigDecimal).ZERO) > 0}">-->
<!--                                        <td>Mã giảm giá</td>-->
<!--                                        <td th:text="'-' + ${#numbers.formatDecimal(couponDiscount, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>-->
<!--                                    </tr>-->
<!--                                    <tr class="order-total">-->
<!--                                        <td>Tổng cộng</td>-->
<!--                                        <td class="order-total-amount"-->
<!--                                            th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>-->
<!--                                    </tr>-->
<!--                                    </tbody>-->
<!--                                </table>-->
<!--                            </div>-->

<!--                            &lt;!&ndash; PHƯƠNG THỨC THANH TOÁN &ndash;&gt;-->
<!--                            <div class="order-payment-method">-->
<!--                                <div class="single-payment">-->
<!--                                    <div class="input-group">-->
<!--                                        <input type="radio" id="pmCOD" name="payment_method" value="COD" checked>-->
<!--                                        <label for="pmCOD">Thanh toán khi nhận hàng (COD)</label>-->
<!--                                    </div>-->
<!--                                    <p>Thanh toán bằng tiền mặt khi nhận hàng.</p>-->
<!--                                </div>-->
<!--                                <div class="single-payment">-->
<!--                                    <div class="input-group">-->
<!--                                        <input type="radio" id="pmMOMO" name="payment_method" value="MOMO">-->
<!--                                        <label for="pmMOMO">Ví MoMo</label>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                                <div class="single-payment">-->
<!--                                    <div class="input-group">-->
<!--                                        <input type="radio" id="pmVNPAY" name="payment_method" value="VNPAY">-->
<!--                                        <label for="pmVNPAY">VNPAY</label>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->

<!--                            <button type="submit" class="axil-btn btn-bg-primary checkout-btn">-->
<!--                                Tiếp tục thanh toán-->
<!--                            </button>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </form>-->

<!--        </div>-->
<!--    </div>-->
<!--</main>-->
<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="vi"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/user}">
<head>
    <title>Thanh toán</title>

    <style>
        /* Canh phải và cố định cách hiển thị ô tiền của toàn bộ cột 2 */
        .summery-table th:nth-child(2),
        .summery-table td:nth-child(2) {
          text-align: right;
          white-space: nowrap;
          font-variant-numeric: tabular-nums;
        }

        /* Theme gán flex/left riêng cho hàng phí vận chuyển -> reset về ô bảng thường */
        .summery-table .order-shipping td:nth-child(2) {
          display: table-cell !important;
          text-align: right !important;
          padding-left: 0 !important;
        }

        /* Một số theme đẩy ký hiệu đ/₫ lên trên (superscript) -> đưa về baseline */
        .summery-table td:nth-child(2) sup,
        .summery-table td:nth-child(2) .currency,
        .summery-table td:nth-child(2) .woocommerce-Price-currencySymbol {
          position: static !important;
          top: 0 !important;
          vertical-align: baseline !important;
          font-size: 1em !important;
          line-height: 1 !important;
        }
    </style>
</head>

<body>
<main layout:fragment="content">
    <div class="axil-checkout-area axil-section-gap">
        <div class="container">

            <form th:action="@{/place-order}" method="post">
                <div class="row">
                    <!-- CỘT TRÁI: ĐỊA CHỈ + GHI CHÚ -->
                    <div class="col-lg-6">
                        <div class="axil-checkout-billing">
                            <h4 class="title mb--40">Chi tiết giao hàng</h4>

                            <div class="mb-4">
                                <a th:href="@{/cart}" class="axil-btn btn-outline btn-sm">
                                    <i class="fal fa-long-arrow-left"></i> Quay lại giỏ hàng
                                </a>
                            </div>

                            <div th:if="${error}" th:text="${error}" class="alert alert-danger"></div>

                            <!-- TH: CHƯA CÓ ĐỊA CHỈ -->
                            <div th:if="${addresses == null or addresses.isEmpty()}" class="mb-4">
                                <div class="alert alert-warning mb-3">
                                    Bạn cần thêm địa chỉ để tiến hành thanh toán.
                                </div>
                                <a th:href="@{/my-account(tab=${'addresses'})}" class="axil-btn btn-outline">
                                    Thêm địa chỉ mới
                                </a>
                            </div>

                            <!-- TH: ĐÃ CÓ ĐỊA CHỈ -->
                            <div th:if="${addresses != null and !addresses.isEmpty()}">
                                <div th:each="address, iter : ${addresses}" class="custom-address-option">
                                    <div class="address-main-content">
                                        <input type="radio"
                                               name="shipping_address"
                                               th:id="'address' + ${iter.index}"
                                               th:value="${address.maDiaChi}"
                                               th:checked="${iter.index == 0}"
                                               class="address-radio">
                                        <label th:for="'address' + ${iter.index}" class="address-content">
                                            <div class="address-header">
                                                <strong th:text="${address.tenNguoiNhan} + ' | ' + ${address.soDienThoai}"></strong>
                                            </div>
                                            <span class="address-details"
                                                  th:text="${address.soNhaDuong} + ', ' + ${address.phuongXa} + ', ' + ${address.quanHuyen} + ', ' + ${address.tinhThanh}"></span>
                                        </label>
                                    </div>

                                    <a th:href="@{/checkout/edit-address/{id}(id=${address.maDiaChi})}"
                                       class="btn-sm address-edit-btn">Sửa</a>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Ghi chú đơn hàng (tùy chọn)</label>
                                <textarea name="notes" rows="2" placeholder="Ghi chú về đơn hàng của bạn..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- CỘT PHẢI: TỔNG TIỀN + PHƯƠNG THỨC THANH TOÁN -->
                    <div class="col-lg-6">
                        <div class="axil-order-summery order-checkout-summery">
                            <h5 class="title mb--20">Đơn hàng của bạn</h5>
                            <div class="summery-table-wrap">
                                <table class="table summery-table">
                                    <!-- FIX: Khóa bề rộng cột tiền để số không “nhảy” -->
                                    <colgroup>
                                        <col>
                                        <col style="width: 170px;">
                                    </colgroup>

                                    <thead>
                                    <tr>
                                        <th>Sản phẩm</th>
                                        <th>Tạm tính</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr th:each="item : ${cartItems}" class="order-product">
                                        <td th:text="${item.sanPham.tenSanPham} + ' x ' + ${item.soLuong}"></td>
                                        <td th:text="${#numbers.formatDecimal(item.thanhTien, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>
                                    </tr>
                                    <tr class="order-subtotal">
                                        <td>Tạm tính</td>
                                        <td th:text="${#numbers.formatDecimal(subtotal, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>
                                    </tr>
                                    <tr class="order-shipping">
                                        <td>Phí vận chuyển</td>
                                        <td th:text="${#numbers.formatDecimal(shippingFee, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>
                                    </tr>
                                    <tr class="order-shipping text-success"
                                        th:if="${membershipDiscount != null and membershipDiscount.compareTo(T(java.math.BigDecimal).ZERO) > 0}">
                                        <td>Giảm giá hạng <strong th:text="${membershipTier != null ? membershipTier.tenHang : ''}"></strong></td>
                                        <td th:text="'-' + ${#numbers.formatDecimal(membershipDiscount, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>
                                    </tr>
                                    <tr class="order-shipping text-success"
                                        th:if="${couponDiscount != null and couponDiscount.compareTo(T(java.math.BigDecimal).ZERO) > 0}">
                                        <td>Mã giảm giá</td>
                                        <td th:text="'-' + ${#numbers.formatDecimal(couponDiscount, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>
                                    </tr>
                                    <tr class="order-total">
                                        <td>Tổng cộng</td>
                                        <td class="order-total-amount"
                                            th:text="${#numbers.formatDecimal(total, 0, 'COMMA', 0, 'POINT')} + ' ₫'"></td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>

                            <!-- PHƯƠNG THỨC THANH TOÁN -->
                            <div class="order-payment-method">
                                <div class="single-payment">
                                    <div class="input-group">
                                        <input type="radio" id="pmCOD" name="payment_method" value="COD" checked>
                                        <label for="pmCOD">Thanh toán khi nhận hàng (COD)</label>
                                    </div>
                                    <p>Thanh toán bằng tiền mặt khi nhận hàng.</p>
                                </div>
                                <div class="single-payment">
                                    <div class="input-group">
                                        <input type="radio" id="pmMOMO" name="payment_method" value="MOMO">
                                        <label for="pmMOMO">Ví MoMo</label>
                                    </div>
                                </div>
                                <div class="single-payment">
                                    <div class="input-group">
                                        <input type="radio" id="pmVNPAY" name="payment_method" value="VNPAY">
                                        <label for="pmVNPAY">VNPAY</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Nút hành động: khóa khi chưa có địa chỉ -->
                            <div th:if="${addresses == null or addresses.isEmpty()}">
                                <button type="button"
                                        class="axil-btn btn-bg-primary checkout-btn"
                                        disabled
                                        th:attr="aria-disabled=true"
                                        title="Hãy thêm địa chỉ trước">
                                    Tiếp tục thanh toán
                                </button>
                            </div>
                            <button th:unless="${addresses == null or addresses.isEmpty()}"
                                    type="submit"
                                    class="axil-btn btn-bg-primary checkout-btn">
                                Tiếp tục thanh toán
                            </button>
                        </div>
                    </div>
                </div>
            </form>

        </div>
    </div>
</main>
</body>
</html>
